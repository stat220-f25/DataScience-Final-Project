---
title: "Final Portfolio Project"
author: "Seth Bonney and Cuong Tran"
format: pdf
geometry: margin=0.75in
---

## Research Question

Will come up soon

```{r}
#| echo: false
#| message: false
#| warning: false

library(tidyverse)
library(janitor)
library(broom)

# Import data
sleep_raw   <- read_csv("Sleep_health_and_lifestyle_dataset.csv")
student_raw <- read_csv("Student_Performance.csv")
factors_raw <- read_csv("StudentPerformanceFactors.csv")

# Clean Sleep dataset
sleep <- sleep_raw |>
  clean_names() |>
  select(
    sleep_duration,              
    sleep_quality = quality_of_sleep,
    stress_level,
    age,
    gender
  ) |>
  drop_na(sleep_duration, sleep_quality, stress_level)

# Create sleep categories
sleep <- sleep |>
  mutate(
    sleep_category = case_when(
      sleep_duration < 7 ~ "Short sleep",
      sleep_duration >= 7 & sleep_duration < 9 ~ "Recommended sleep",
      sleep_duration >= 9 ~ "Long sleep"
    ),
    sleep_category = factor(
      sleep_category,
      levels = c("Short sleep", "Recommended sleep", "Long sleep")
    )
  )

# Clean Student Performance dataset
student <- student_raw |>
  clean_names()

student <- student |>
  select(
    performance_index,
    previous_scores,
    hours_studied,
    sleep_hours
  ) |>
  drop_na(performance_index, previous_scores, hours_studied)

# Clean Student Performance Factors dataset
factors <- factors_raw |>
  clean_names()
factors <- factors |>
  select(
    study_hours = hours_studied,     
    score = previous_scores,
    sleep_hours = sleep_hours
  ) |>
  drop_na()

# Some summary statistics 
sleep_summary <- sleep |>
  summarise(
    mean_sleep   = mean(sleep_duration),
    median_sleep = median(sleep_duration),
    sd_sleep     = sd(sleep_duration),
    mean_quality = mean(sleep_quality),
    mean_stress  = mean(stress_level)
  )

student_summary <- student |>
  summarise(
    mean_grade   = mean(performance_index),
    median_grade = median(performance_index),
    mean_prev    = mean(previous_scores),
    mean_study   = mean(hours_studied)
  )

factor_summary <- factors |>
  summarise(
    mean_score   = mean(score),
    mean_sleep    = mean(sleep_hours),
    mean_study   = mean(study_hours)
  )

# Data Joining
avg_factors <- factors |>
  group_by(sleep_hours) |>
  summarise(avg_study = mean(study_hours, na.rm = TRUE),
            avg_score = mean(score, na.rm = TRUE))

avg_sleep <- sleep |>
  mutate(sleep_hours = round(sleep_duration)) |>
  group_by(sleep_duration) |>
  summarise(avg_sleep_quality = mean(sleep_quality, na.rm = TRUE),
            avg_stress_level = mean(stress_level, na.rm = TRUE),
            sleep_hours = sleep_hours)

joined_sleep_factors <- left_join(avg_factors, avg_sleep, by = join_by(sleep_hours))

avg_students <- student |>
  group_by(sleep_hours) |>
  summarise(avg_performance = mean(performance_index, na.rm = TRUE),
            avg_previous_score = mean(previous_scores, na.rm = TRUE),
            avg_hours_studied = mean(hours_studied, na.rm = TRUE))

full_data <- full_join(joined_sleep_factors, avg_students, by = join_by(sleep_hours)) |> drop_na() |> distinct()


```



```{r}
full_data_clean <- full_data |>
  select(-c(sleep_hours)) |>
  relocate(sleep_duration)

```



## Research question 1
```{r}
library(ggplot2)
ggplot(sleep, aes(sleep_duration)) +
  geom_histogram(bins = 20) +
  theme_minimal() +
  labs(
    title = "Distribution of Sleep Duration",
    x = "Sleep hours",
    y = "Count"
  )

ggplot(sleep, aes(sleep_category)) +
  geom_bar() +
  theme_minimal() +
  labs(
    title = "Sleep Category Distribution"
  )

ggplot(sleep, aes(sleep_duration, stress_level)) +
  geom_jitter(alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE) +
  theme_minimal() +
  labs(
    title = "Sleep Duration vs Stress",
    x = "Hours of Sleep",
    y = "Stress Level"
  )

```


## Research question 3
```{r}
# Sleep hours vs academic performance index
ggplot(full_data, aes(x = sleep_duration, y = avg_performance)) +
  geom_point() +
  theme_minimal() +
  labs(
    title = "Average Performance Index by Sleep Hours",
    x = "Sleep Hours (rounded)",
    y = "Average Performance Index"
  )

# Sleep hours vs previous scores
ggplot(full_data, aes(x = sleep_duration, y = avg_previous_score)) +
  geom_point() +
  theme_minimal() +
  labs(
    title = "Average Previous Scores by Sleep Hours",
    x = "Sleep Hours (rounded)",
    y = "Average Previous Score"
  )

# Sleep hours vs hours studied
ggplot(full_data, aes(x = sleep_duration, y = avg_hours_studied)) +
  geom_point() +
  theme_minimal() +
  labs(
    title = "Average Study Time by Sleep Hours",
    x = "Sleep Hours (rounded)",
    y = "Average Hours Studied"
  )

# Sleep hours vs exam score (from factors dataset)
ggplot(full_data, aes(x = sleep_duration, y = avg_score)) +
  geom_point() +
  theme_minimal() +
  labs(
    title = "Average Exam Score by Sleep Hours",
    x = "Sleep Hours (rounded)",
    y = "Average Exam Score"
  )

# Sleep hours vs sleep quality
ggplot(full_data, aes(x = sleep_duration, y = avg_sleep_quality)) +
  geom_point() +
  theme_minimal() +
  labs(
    title = "Average Sleep Quality by Sleep Hours",
    x = "Sleep Hours (rounded)",
    y = "Average Sleep Quality"
  )

# Sleep hours vs stress level
ggplot(full_data, aes(x = sleep_duration, y = avg_stress_level)) +
  geom_point() +
  theme_minimal() +
  labs(
    title = "Average Stress Level by Sleep Hours",
    x = "Sleep Hours (rounded)",
    y = "Average Stress Level"
  )
```


